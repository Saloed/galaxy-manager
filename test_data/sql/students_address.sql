SELECT
 t$Persons.F$FIO
,(CASE WHEN AdrReg.F$NREC = T$PERSONS.F$LIVEADDR THEN 'Адрес проживания' ELSE 'Адрес по прописке' END) AS AddressType
,(CASE WHEN AdrReg.F$NREC = T$PERSONS.F$LIVEADDR THEN 2 ELSE 1 END) AS ID
,(CASE WHEN Adr1.F$WTYPE = 1 THEN Adr1.F$SNAME ELSE CASE WHEN Adr2.F$WTYPE = 1 THEN Adr2.F$SNAME ELSE CASE WHEN Adr3.F$WTYPE = 1 THEN Adr3.F$SNAME ELSE '' END END END) AS AddrF0
,'' AS AddrF0_ID
,AdrReg.F$SPOSTIND AS AddrF1
,'' AS AddrF1_ID
,(CASE WHEN (Adr2.F$WTYPE = 20 OR Adr2.F$WTYPE = 3) THEN Adr2.F$SNAME ELSE CASE WHEN (Adr1.F$WTYPE = 20 OR Adr1.F$WTYPE = 3) THEN Adr1.F$SNAME ELSE CASE WHEN (Adr0.F$WTYPE = 20 OR Adr0.F$WTYPE = 3) THEN Adr0.F$SNAME ELSE
'' END END END) AS AddrF2
,(CASE WHEN (Adr2.F$WTYPE = 20 OR Adr2.F$WTYPE = 3) THEN Adr2.F$REGIONCODE ELSE CASE WHEN (Adr1.F$WTYPE = 20 OR Adr1.F$WTYPE = 3) THEN Adr1.F$REGIONCODE ELSE CASE WHEN (Adr0.F$WTYPE = 20 OR Adr0.F$WTYPE = 3) THEN Adr0.F$REGIONCODE ELSE
'' END END END) AS AddrF2_ID
,(CASE WHEN (Adr1.F$WTYPE = 3 OR Adr1.F$WTYPE = 2) THEN Adr1.F$SNAME ELSE '' END) AS AddrF3
,(CASE WHEN (Adr1.F$WTYPE = 3 OR Adr1.F$WTYPE = 2) THEN Adr1.F$AREACODE ELSE '' END) AS AddrF3_ID
,(CASE WHEN Adr0.F$WTYPE = 4 THEN Adr0.F$SNAME ELSE '' END) AS AddrF4
,(CASE WHEN Adr0.F$WTYPE = 4 THEN Adr0.F$CITYCODE ELSE '' END) AS AddrF4_ID
,(CASE WHEN Adr0.F$WTYPE = 5 THEN Adr0.F$SNAME ELSE '' END) AS AddrF5
,(CASE WHEN Adr0.F$WTYPE = 5 THEN Adr0.F$PLACECODE ELSE '' END) AS AddrF5_ID
,AdrReg.F$SADDRESS2 AS AddrF6
,'' AS AddrF6_id
,AdrReg.F$SHOUSE AS AddrF7
,'' AS AddrF7_id
,AdrReg.F$SBlock AS AddrF8
,'' AS AddrF8_id
,AdrReg.F$SFlat AS AddrF9
,'' AS AddrF9_id
, COALESCE(Ul.F$SGNI_CODE,adr0.f$SGNI_CODE,' ') AS kladrstreet
FROM t$U_student UStudent
INNER JOIN T$PERSONS ON T$PERSONS.F$NREC = UStudent.F$CPERSONS
LEFT OUTER
JOIN t$AddressN AdrReg ON AdrReg.F$NREC = T$PERSONS.F$PASSPADDR
LEFT OUTER
JOIN t$sTerr Adr0 ON Adr0.f$nRec = AdrReg.F$CSTERR
LEFT OUTER
JOIN t$sTerr Adr1 ON Adr1.f$nRec = Adr0.F$CPARENT
LEFT OUTER
JOIN t$sTerr Adr2 ON Adr2.f$nRec = Adr1.F$CPARENT
LEFT OUTER
JOIN t$sTerr Adr3 ON Adr3.f$nRec = Adr2.F$CPARENT
LEFT OUTER
JOIN T$STREETS ON T$STREETS.F$NREC = AdrReg.F$CSTREET
LEFT OUTER
JOIN T$STerr Ul ON Ul.F$NREC = AdrReg.F$CSTREET
WHERE
UStudent.f$nREc = CONVERT(BINARY(8), %s, 1)
